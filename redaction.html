<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAKMUS — Mémoire & Vérité</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/x88LbhZp/2_20251224_213424_0001.png">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7567982675325882" crossorigin="anonymous"></script>
    <meta name="google-adsense-account" content="ca-pub-7567982675325882">
    <style>
        /* Style pour les recommandations en bas d'article */
        .recommendations { max-width: 850px; margin: 60px auto; padding: 20px; border-top: 3px double #000; }
        .recommendations h3 { font-family: 'Libre Baskerville', serif; text-transform: uppercase; text-align: center; margin-bottom: 30px; }
        .rec-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .rec-card { text-decoration: none; color: #000; transition: 0.3s; font-size: 0.9rem; }
        .rec-card img { width: 100%; height: 130px; object-fit: cover; margin-bottom: 10px; border: 1px solid #eee; }
        .rec-card h4 { margin: 0; line-height: 1.2; }
        .rec-card:hover { opacity: 0.7; }
    </style>
</head>
<body>

<div class="full-menu" id="fullMenu">
    <div class="menu-header">
        <div class="menu-logo">MAKMUS</div>
        <span class="close-menu" id="closeMenu">&times; FERMER</span>
    </div>
    <div class="menu-content">
        <div class="menu-search">
            <input type="text" id="menuSearchInput" placeholder="RECHERCHER DANS LES ARCHIVES...">
            <button onclick="alert('Recherche bientôt disponible')">OK</button>
        </div>
        <div class="menu-grid">
            <div class="menu-section">
                <h3>ACTUALITÉS</h3>
                <ul>
                    <li><a href="index.html">À la une</a></li>
                    <li><a href="index.html">RDC</a></li>
                    <li><a href="index.html">Politique</a></li>
                </ul>
            </div>
            <div class="menu-section">
                <h3>SERVICES</h3>
                <ul>
                    <li><a href="jeux.html">Jeux & Puzzles</a></li>
                    <li><a href="#">Abonnements</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="top-bar">
    <div class="top-bar-content">
        <div id="live-date">---</div>
        <div class="auth-section"><button id="openModal">MON COMPTE</button></div>
    </div>
</div>

<header class="main-header">
    <div class="header-left">
        <div class="menu-toggle" id="btnOpenMenu">
            <span></span><span></span><span></span>
            <span class="menu-label">SECTIONS</span>
        </div>
    </div>
    <div class="logo-container">
        <a href="index.html">
            <img src="https://i.postimg.cc/7ZWdGrQc/Screenshot_2025_12_24_21_32_24_removebg_preview.png" alt="MAKMUS">
        </a>
    </div>
    <div class="header-right-spacer">
        <button class="btn-subscribe">S'ABONNER</button>
    </div>
</header>

<main class="newspaper-body">
    <div id="full-article">
        <p style="text-align:center; padding:50px;">Chargement de l'analyse...</p>
    </div>

    <section class="recommendations">
        <h3>À lire aussi</h3>
        <div class="rec-grid" id="recommendations-grid"></div>
    </section>
</main>

<footer class="nyt-footer">
    <div class="footer-container">
        <div class="footer-brand">
            <img src="https://i.postimg.cc/7ZWdGrQc/Screenshot_2025_12_24_21_32_24_removebg_preview.png" alt="MAKMUS">
            <p>La vérité pour mémoire. L'excellence du journalisme en RDC.</p>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 MAKMUS MEDIA GROUP. Tous droits réservés.</p>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    // --- 1. CONFIGURATION ---
    const SUPABASE_URL = 'https://logphtrdkpbfgtejtime.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvZ3BodHJka3BiZmd0ZWp0aW1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzY4MDYsImV4cCI6MjA4NTc1MjgwNn0.Uoxiax-whIdbB5oI3bof-hN0m5O9PDi96zmaUZ6BBio'; 
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const params = new URLSearchParams(window.location.search);
    const articleId = params.get('id');

    // --- 2. GESTION DU MENU ---
    const btnOpenMenu = document.getElementById('btnOpenMenu');
    const btnCloseMenu = document.getElementById('closeMenu');
    const fullMenu = document.getElementById('fullMenu');

    if (btnOpenMenu) btnOpenMenu.onclick = () => fullMenu.classList.add('open');
    if (btnCloseMenu) btnCloseMenu.onclick = () => fullMenu.classList.remove('open');

    // --- 3. GESTION DE LA DATE ---
    function updateDate() {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const liveDate = document.getElementById('live-date');
        if(liveDate) liveDate.textContent = new Date().toLocaleDateString('fr-FR', options).toUpperCase();
    }
    updateDate();

    // --- 4. CHARGEMENT DES SUGGESTIONS ---
    async function loadRecommendations(excludeId) {
        const recGrid = document.getElementById('recommendations-grid');
        if (!recGrid) return;
        try {
            const { data: recs, error } = await supabaseClient
                .from('articles')
                .select('id, titre, image_url')
                .neq('id', excludeId)
                .limit(3)
                .order('created_at', { ascending: false });

            if (!error && recs) {
                recGrid.innerHTML = recs.map(post => `
                    <a href="redaction.html?id=${post.id}" class="rec-card">
                        ${post.image_url ? `<img src="${post.image_url}" alt="${post.titre}">` : '<div style="height:130px; background:#eee;"></div>'}
                        <h4>${post.titre}</h4>
                    </a>
                `).join('');
            }
        } catch (e) { console.error(e); }
    }

    // --- 5. CHARGEMENT DE L'ARTICLE ---
    async function loadArticle() {
        const display = document.getElementById('full-article');

        if (!articleId) {
            display.innerHTML = "<div style='text-align:center; padding:50px;'><h2>Erreur</h2><p>Aucun article sélectionné.</p><a href='index.html'>Retour à l'accueil</a></div>";
            return;
        }

        try {
            const { data: art, error } = await supabaseClient
                .from('articles')
                .select('*')
                .eq('id', articleId)
                .single();

            if (error || !art) throw new Error("Article introuvable");

            display.innerHTML = `
                <header class="article-header">
                    <div class="article-meta">
                        Publié par la Rédaction MAKMUS — ${new Date(art.created_at).toLocaleDateString('fr-FR')}
                    </div>
                    <h1>${art.titre}</h1>
                </header>
                
                ${art.image_url ? `
                    <div class="article-full-img">
                        <img src="${art.image_url}" alt="${art.titre}">
                    </div>` : ''}
                
                <div class="article-content">${art.description}</div>
            `;
            
            document.title = `${art.titre} - MAKMUS`;
            loadRecommendations(articleId);

        } catch (e) {
            console.error(e);
            display.innerHTML = "<div style='text-align:center; padding:50px;'><h2>Article introuvable</h2><a href='index.html'>Retour</a></div>";
        }
    }

    loadArticle();
</script>
</body>
</html>
